const API_URL="https://madarom-project-production.up.railway.app/api/products",productContainer=document.getElementById("product-container"),paginationContainer=document.getElementById("pagination"),detailSection=document.getElementById("product-detail");let allProducts=[],filteredProducts=[],currentPage=1;const perPage=6;let activeSubCategoryId=null;async function fetchProducts(){try{var e=await(await fetch(API_URL)).json();allProducts=e,filteredProducts=allProducts,renderProducts(),renderPagination()}catch(e){console.error("Erreur API :",e)}}function renderProducts(){var e=(currentPage-1)*perPage,e=filteredProducts.slice(e,e+perPage);productContainer.innerHTML=e.map(e=>`
    <div class="product-card bg-white rounded-xl overflow-hidden shadow-md transition duration-300 cursor-pointer" onclick="showDetail(${e.id})" data-aos="fade-right">
      <div class="h-48 bg-[#fcffff] flex items-center justify-center">
        <img src="${e.image_url??"../assets/img/p1.png"}" alt="${e.name_fr}" class="h-full w-full object-cover">
      </div>
      <div class="p-5">
        <h3 class="text-xl font-semibold mb-2">${e.name_latin}</h3>
        <p class="text-gray-600 mb-4">${e.name_fr?.slice(0,60)}</p>
        <div class="flex justify-between items-center">
          <span class="text-2xl font-bold text-teal">–</span>
          <button class="btn-primary text-white px-4 py-2 text-sm">View Details</button>
        </div>
      </div>
    </div>
  `).join("")}function renderPagination(){const t=Math.ceil(filteredProducts.length/perPage);paginationContainer.innerHTML="";var r=document.createElement("nav"),e=(r.className="flex items-center space-x-2",document.createElement("button"));e.innerHTML="&laquo;",e.className="px-3 py-1 rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100",e.disabled=1===currentPage,e.addEventListener("click",()=>{1<currentPage&&(currentPage--,renderProducts(),renderPagination())}),r.appendChild(e);for(let e=1;e<=t;e++){var a=document.createElement("button");a.textContent=e,a.className="px-4 py-1 rounded-full border "+(e===currentPage?"bg-teal text-white":"border-gray-300 text-gray-600 hover:bg-gray-100"),a.addEventListener("click",()=>{currentPage=e,renderProducts(),renderPagination()}),r.appendChild(a)}e=document.createElement("button"),e.innerHTML="&raquo;",e.className="px-3 py-1 rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100",e.disabled=currentPage===t,e.addEventListener("click",()=>{currentPage<t&&(currentPage++,renderProducts(),renderPagination())}),r.appendChild(e),e=document.createElement("div");e.className="mt-12 flex justify-center",e.appendChild(r),paginationContainer.appendChild(e)}function showDetail(t){var e=allProducts.find(e=>e.id===t);e&&(detailSection.classList.remove("hidden"),detailSection.scrollIntoView({behavior:"smooth"}),detailSection.innerHTML=`
    <div class="container mx-auto px-4">
      <div class="flex flex-col lg:flex-row gap-12 items-center">
        <div class="w-full lg:w-1/2">
          <div class="bg-gray-100 rounded-xl overflow-hidden h-96 flex items-center justify-center">
            <img src="${e.image_url??"../assets/img/p1.png"}" alt="${e.name_fr}" class="h-full w-full object-cover">
          </div>
        </div>
        <div class="w-full lg:w-1/2">
        <p class="text-4xl font-bold mb-4">${e.name_latin??"–"}</p>
          <h2 class="text-2xl font-bold mb-4 text-gray-600">${e.name_fr}</h2>
          <p class="text-gray-700 mb-4">${e.description_fr}</p>
          <p class="text-gray-600 mb-4">Catégorie : ${e.category?.name??"–"}</p>
          <button class="mt-6 btn-primary text-white px-6 py-2 rounded-full" onclick="hideDetail()">Fermer</button>
        </div>
      </div>
    </div>
  `)}function hideDetail(){detailSection.classList.add("hidden")}async function loadCategories(){const n=document.getElementById("category-container");try{(await(await fetch("https://madarom-project-production.up.railway.app/api/categories")).json()).forEach(e=>{var t=document.createElement("label"),r=(t.className="flex items-center space-x-3 cursor-pointer",document.createElement("input")),a=(r.type="checkbox",r.className="form-checkbox h-5 w-5 text-teal rounded border-gray-300",r.value=e.id,r.setAttribute("data-type","category"),r.addEventListener("change",()=>{filterProducts()}),document.createElement("span"));a.textContent=e.name,t.appendChild(r),t.appendChild(a),n.appendChild(t)})}catch(e){console.error("Erreur lors du chargement des catégories:",e)}}async function loadSubCategories(){const r=document.getElementById("subcategory-container");try{(await(await fetch("https://madarom-project-production.up.railway.app/api/subcategories")).json()).forEach(e=>{var t=document.createElement("div");t.className="filter-item p-2 rounded cursor-pointer",t.textContent=e.name,t.setAttribute("data-id",e.id),t.setAttribute("data-type","subcategory"),t.addEventListener("click",()=>{activeSubCategoryId=activeSubCategoryId===e.id?null:e.id,filterProducts(),highlightSelectedSubcategory()}),r.appendChild(t)})}catch(e){console.error("Erreur lors du chargement des sous-catégories :",e)}}function filterProducts(){const r=Array.from(document.querySelectorAll('input[data-type="category"]:checked')).map(e=>parseInt(e.value));filteredProducts=allProducts.filter(e=>{var t=0===r.length||r.includes(e.category_id),e=!activeSubCategoryId||e.sub_category_id===activeSubCategoryId;return t&&e}),currentPage=1,renderProducts(),renderPagination()}function highlightSelectedSubcategory(){document.querySelectorAll('[data-type="subcategory"]').forEach(e=>{parseInt(e.getAttribute("data-id"))===activeSubCategoryId?e.classList.add("bg-teal","text-white"):e.classList.remove("bg-teal","text-white")})}document.addEventListener("DOMContentLoaded",fetchProducts),loadCategories(),loadSubCategories();